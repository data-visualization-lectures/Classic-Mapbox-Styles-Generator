(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function s(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=s(e);fetch(e.href,o)}})();const d=document.getElementById("style"),y=document.getElementById("generator-form"),t=document.getElementById("message"),m=document.getElementById("result-section"),f=document.getElementById("generated-url"),l=document.getElementById("download-btn"),p=document.getElementById("preview-wrapper"),u=document.getElementById("style-preview"),v="style-previews";async function w(){try{const n=await fetch("styles.csv");if(!n.ok)throw new Error("CSV を読み込めませんでした。");const r=await n.text();x(r)}catch(n){t.textContent=n.message,t.style.color="#c62828"}}function x(n){n.trim().split(/\r?\n/).slice(1).forEach(s=>{const[c,e]=s.split(",");if(!c||!e)return;const o=document.createElement("option");o.value=e.trim(),o.textContent=c.trim(),d.appendChild(o)})}function g(n){if(!n){p.hidden=!0,u.removeAttribute("src"),u.alt="";return}const r=d.options[d.selectedIndex],s=r?r.textContent.trim():"",c=`${v}/${n}.png`;u.src=c,u.alt=`${s} のプレビュー`,p.hidden=!1}y.addEventListener("submit",n=>{n.preventDefault(),t.textContent="",t.style.color="#c62828",l.disabled=!0;const r=y.token.value.trim(),s=d.value.trim();if(g(s),!r||!s){t.textContent="トークンとスタイルを入力してください。",t.style.color="#c62828",m.hidden=!0,l.disabled=!0;return}const c=`https://api.mapbox.com/styles/v1/mapbox/${s}?access_token=${encodeURIComponent(r)}`;f.textContent=c,m.hidden=!1,l.disabled=!1});d.addEventListener("change",n=>{const r=n.target.value.trim();t.textContent="",t.style.color="#c62828",m.hidden=!0,l.disabled=!0,f.textContent="",g(r)});u.addEventListener("error",()=>{p.hidden=!0,t.textContent="プレビュー画像を読み込めませんでした。",t.style.color="#c62828"});l.addEventListener("click",async()=>{const n=f.textContent.trim();if(!n){t.textContent="先に URL を生成してください。",t.style.color="#c62828";return}l.disabled=!0;const r=l.textContent;l.textContent="ダウンロード中...";try{const s=await fetch(n);if(!s.ok)throw new Error(`JSON の取得に失敗しました (HTTP ${s.status}).`);const c=await s.json(),e=JSON.stringify(c,null,2),o=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(o),h=`${d.value||"style"}.json`,a=document.createElement("a");a.href=i,a.download=h,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(i),t.textContent="JSON をダウンロードしました。",t.style.color="#2e7d32",setTimeout(()=>{t.textContent="",t.style.color="#c62828"},2e3)}catch(s){console.error(s),t.textContent=s.message,t.style.color="#c62828"}finally{l.disabled=!1,l.textContent=r}});w();
